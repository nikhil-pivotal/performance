# Mathematics of Portfolio Return

The rate of return is the gain or loss in market value of the portfolio relative to its starting value

```
r = (Ve - Vs)/Vs  or

r = (Ve/Vs) - 1

(1 + r) = Ve/Vs
```

`Ve/Vs` is termed as the wealth ratio that describes the change in wealth over the time period. It equals the rate of return plus 1.

If there are no external cash flows, the rate of return over the entire time periods is the compounded return over
multiple sub-periods

```
V1/Vs * V2/V1 * V3/V2 * ...... * Vn-1/Vn-2 * Ve/Vn-1 = Ve/Vs = (1 + r)  or

(1 + r1) * (1 + r2) * (1 + r3) * .... * (1 + rn) = (1 + r)
```

When there are external cash flows we need to adjust the methodology to make allowances for them since they do contribute
to the return.

## Money Weighted Rate of Return

The method of money weighted rate of return assumes that each dollar invested in the portfolio achieves the same
rate of return regardless of the time at which it was invested. `The weight of money invested in the portfolio at
any point in time will ultimately impact the final return`. Thus this methodology is biased towards the amount of
money invested: the return achieved when the amount of money invested is the largest will influence the final return 
the most. 

### IRR

```
Ve = Vs * (1 + r) + C1*(1 + r)^W1 + C2*(1 + r)^W2 + .... + CT*(1 + r)WT

Ct = the external cash flow on day t
Wt = weighting ratio to be applied on day t

Wt = (TD - Dt) / TD
Or WtY: When computing annualized IRR, you would use a weight for the length of time measured in years
WtY = Y - Yt  (Yt could be a fraction if investments were made during any year)

TD: Total number of days within the measurement period
Dt: Number of days since the beginning of the measurement period including holidays and weekends
```

### Simple Dietz

```
r = (Ve - Vs - C) / (Vs + C/2)

Assumes all of the external cash flow occurred midway through the performance measurement period
```

The Denominator is a measure of the average capital available for investment. 


### ICAA Method
Proposed by the Investment Council Association of America

```
r = (Ve - Vs - C + I) / (Vs + C/2)

I: Investment income generated by the portfolio
Assumes Investment income is available for re-investment

r = (Ve - Vs - C + I) / (Vs + (C - I)/2)

Assumes investment income is not available for re-investment and hence subtracted from the average capital.
```

### Modified Dietz

```
r = (Ve - Vs - C) / (Vs + Sum(Ci*Wi)

Ci: Cash flow at time i
Wi: Weight at time i

Wi = (TD - Di) / TD
Td: Total Days
Di: Number of days since the beginning of the period including holidays and weekends
    Di: Di+1 when start of day
```

If the cash flow occurred at the start of the day, it is reasonable to assume the portfolio manager has the entire
day use it to achieve the return in the time period. If it occurred at the end of the day, the portfolio manager
cannot use it for that day. So for start of day we add an additional day to the overall time period when calculating
the weight of the cash flow


## Time Weighted Rate of Return

Time alternative to money weighted return in that `each time period is given an equal weight regardless of the 
amount invested`.

In true time weighted return, a performance return is calculated for each sub-period between cash flows using 
simple wealth ratios. The returns for each of these sub-periods are then chain linked together to get the 
overall return

### Cash flow Timing dependence

If we assume an end of day cash flow, the formula to compute a time weighted return is as follows

```
(1 + r) = (V1 - C1)/Vs  * (V2 - C2)/V1 * ..... * (Vn-1 - Cn-1)/Vn-2 * Ve - Cn/Vn-1

(1 + r) = (1 + r1) * (1 + r2) * ..... (1 + rn-1) * (1 + rn)

Vi: Value of the portfolio just after a cash flow of Ci in the period i
Assumes an end of day Cash Flow occurrance
``` 

If we assume cash flows occur at the start of the day the equation for Time Weighted return changes to the 
following

```
(1 + r) = V1 / (Vs) * V2 / (V1 + C1) * ......  * Vn-1 / (Vn-2 + Cn-2) * Ve / (Vn-1 + Cn-1)  => No cash flow at the end

Vi: Market value of the portfolio at the start of the day just prior to receiving Cash flow Ci
Assumes a begin of day cash flow.
The Cash flow received at Time period i is used as the bmv to calculate the return for Time period i+1
```

For mid-day cash flow the equation changes to the following. This is a case of weighting the cash flow and is 
therefore no longer a true time weighted return

```
(1 + r) = V1 - Vs - C1 / (Vs + C1/2) * Vi - Vi-1 - Ci / (Vi-1 + Ci/2) * .... * Ve - Vn-1 - Cn / (Vn-1 - Cn/2)
```


### Unit Price (Unitized) Method

Is a variant of the Time Weighted return and calculated using a Unit Price or a NAV value of the portfolio.
The Net Asset Value (NAV) or Unit Price is calculated immediately before each external cash flow by dividing the
market value by the number of units previously allocated. The Cash flow is accounted for by then adding or 
subtracting (depending on the direction of the cash flow) a proportional number of units corresponding to the
time of the cash flow. The starting unit price value of the portfolio is usually assigned a notional value of
`1` or `100`.

```
(1 + r) = NAV1/NAVs * NAV2/NAV1 * ...... * NAVn-2/NAV/n-1 * NAVe/NAVn-1
```

An advantage of the unit price method is the ratio of the ending NAV value to the beginning NAV value provides
the same overall rate of return irrespective of the change in the portfolio value during the sub-periods due to
external cash flows

```
(1 + r) = NAVe/NAVs
        = NAV1/NAVs * NAV2/NAV1 * ...... * NAVn-2/NAV/n-1 * NAVe/NAVn-1
```

The Unit price can reconcile to the Time Weighted Return assuming the portfolio values and timing of cash flows
are properly aligned (proving it to be a Time Weighted Return variant).